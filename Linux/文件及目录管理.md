# 文件系统概述
#### 文件结构

文件包含本身所包含的数据外还包含文件的属性


1. /:根目录
2. /bin:普通用户可执行的命令,任何用户都可以执行该目录的命令
3. /boot:系统内核启动需要的文件
4. /home:用户的主目录.每个用户都有一个自己的目录,在该目录下
5. /root:超级权限者用户的主目录
6. /lib:用户存放各种库文件
7. /etc:系统中的配置文件
8. /usr:应用目录(类似windows的program files)
    * /usr/bin:系统使用的应用程序
    * /usr/sbin:root用户使用的高级管理程序和系统守护程序
    * /usr/src:系统内核源代码
9. /var:缓存或者运行产生的文件
10. /dev:外设
11. /tmp:临时文件
12. /run:临时文件系统,存放系统启动以来的信息,系统重启就会别清清除

##### 文件系统模型

![alt text](image-42.png)

1. 通过设备驱动本身的接口直接访问物理磁盘.(不稳定)
2. 通过虚拟文件系统直接读写文件上的内容,只存在于内存不存在于磁盘

#### 目录,索引结点和文件描述符

文件控制块(FCB):为对一个文件进行正确的读写,用于为文件设置描述和控制文件的数据结构.

文件目录:FCB的有序集合

目录文件:将文件目录以文件的形式保存在外存上的文件

FCB的三类信息
1. 基本信息,如文件名,文件物理位置,文件逻辑结构和文件物理结构
2. 控制信息,如文件的所有者存取权限,所有者所在组的存取权限,其他用户的存取权限
3. 信息类,如文件建立日期和时间,文件上一次修改日期和时间,当前使用信息项

索引结点(inode):数据块,包含文件创建.修改日期,文件访问权限,文件在磁盘上的存放位置等信息.文件系统给每个inode分配一个号码,称为索引结点编号

linux将FCB(内核中dentry结构体)组织为`文件名,索引结点编号`的结构

文件描述符:文件描述符是一个非负整数,用于表示打开的文件、设备、管道或网络连接等资源。当程序通过系统调用如 open()、socket() 等打开文件或其他资源时，操作系统为该资源 分配一个文件描述符。

#### 文件的分类

1. 普通文件
2. 目录文件
3. 字符特殊文件:表示系统字符类型的设备,如键盘鼠标等
4. 块特殊文件:表述系统中块类型的设备,如硬盘,光驱等
5. FIFO:用于进程间的通信,也称命名管道
6. 套接字(socket):主要用于网络通信,也可用于一台主机上的进程之间的通信
7. 符号链接:指向另一个文件,是另一个文件的引用.

`ls -l`:查看文件类型

![alt text](image-43.png)

最左边第一项第一个字母是文件类型的缩写
|字符|含义|
|---|---|
|-  (regular)|普通文件|
|d (directory)|  目录文件
|c (character)|  字符设备文件
|b (block)|  块设备文件
|p (pipe)  |    管道文件(命名管道)
|s (socket) |    套接字文件
|l (link)|      链接文件

#### 文件访问权限控制

![alt text](image-44.png)


输出结果依次为:文件类型+访问权限,连接数,文件所有者,文件所有者所在组,文件大小(字节),文件创建时间,文件命.

第一项共10位,第一位为文件类型.剩下9位3位一组.分别表示不同用户对该文件的操作权限,r可读,w可写,x可执行
1. 文件所有者
2. 文件所有者同组用户
3. 其他用户

`chmod 666 test.c`: 对文件访问权限进行修改

对于三种对应3个值分别为:
r=4,w=2,x=1

##### st_mode结构

文件的类型与访问权限被定义在st_mode的内核数据结构中,实质上是一个无符号16位短整型数

![alt text](image-45.png)

1. st_mode[0:8]:对应用户的权限 8-6所有者 5-3是同组者 2-0是其他用户
2. st_mode[12:15]:用作文件类型,最多可标识16中,现已用7中
3. st_mode[9:11]:文件的特殊属性,1表示有,0表示没,分别为suid,sgid,sticky

st_mode[10]和st_mode[11]分别设置suid和sgid

suid为1 任何用户执行该文件时均获得该文件所有者的临时授权,有效UID等于该文件所有者的UID
sgid为1 任何用户执行该文件时均获得该目录所属组成员临时授权,有效UID等于该目录所属组成员的UID

这种机制适用于让普通用户运行只有root用户才能使用的程序或者命令

![alt text](image-46.png)

s出现在文件所有者执行权限位上,说明suid位置为1;若s出现在用户组执行权限位上,说明sgid为1.若t出现在其他组的x位上,说明sticky为1.sticky(只对目录有效)在当前用户有该目录的写权限,只用于该用户删除本目录下属于自己的文件.

suid,sgid和sticky可通过chmod命令实现,在表示读写执行权限前加上者三个权限的表示数字之和

suid=4,sgid=2,sticky=1

`chmod 7666 test.c`

表示将文件权限的suid,sgid,sticky都置为1